#!/usr/bin/env bash

set -ex

NAMESPACE=${NAMESPACE:-tugboat}

DOCKERFILE=$1
pushd $(dirname $DOCKERFILE)

echo Building docker image from $DOCKERFILE

NAME=$(cat NAME)
TAG=$(cat TAGS | cut -d' ' -f1)
ALIASES=$(cat TAGS | cut -d' ' -f2-)
IMAGE=${NAMESPACE}/${NAME}:${TAG}

docker build --pull -t $IMAGE .

for ALIAS in ${ALIASES}; do
    docker tag ${IMAGE} ${NAMESPACE}/${NAME}:${ALIAS}
done

popd